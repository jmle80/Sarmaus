<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <title>Ty√∂ajan seuranta v2.7</title>
    <style>
        /* Versio-nro ensimm√§isell√§ rivill√§ eri v√§risen√§ */
        .version-tag { color: #ff8c00; font-weight: bold; margin-bottom: 10px; }
        
        body { font-family: sans-serif; display: flex; justify-content: center; padding: 20px; background: #f4f4f4; }
        #app-card { 
            background: white; padding: 30px; border-radius: 15px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 450px;
            border: 4px solid #ccc; transition: border-color 0.3s; text-align: center;
        }
        input { width: 80%; padding: 15px; font-size: 1.2rem; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; }
        input:focus { outline: none; border-color: #ffd700; } /* Keltainen reuna sy√∂tett√§ess√§ */
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; margin: 5px; }
        .btn-next { background: #4CAF50; color: white; width: 80%; }
        .btn-skip { background: #ddd; color: #333; }
        .btn-reset { background: #f44336; color: white; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>

<div id="app-card">
    <div class="version-tag">Versio 2.7 üü†</div>
    
    <div id="ui-content">
        </div>
</div>

<script>
// --- 1. TUPLALATAUKSEN ESTO üîí ---
const lockChannel = new BroadcastChannel('sovellus_lukitus');
lockChannel.onmessage = (e) => {
    if (e.data === 'ping') lockChannel.postMessage('pong');
    if (e.data === 'pong') {
        alert("Sovellus on jo auki toisessa v√§lilehdess√§!");
        window.close();
        document.body.innerHTML = "<h1>P√§√§sy estetty: Tuplalataus</h1>";
    }
};
lockChannel.postMessage('ping');

// --- 2. TIETORAKENNE üì¶ ---
let tyovaiheTiedot = {
    id: "",
    asetusaika: 0,
    taivutusaika: 0,
    muutVaiheet: []
};

let vaihe = 1; // 1: ID, 2: Asetus, 3: Taivutus, 4: Yhteenveto

// --- 3. TOIMINNALLISUUS ‚öôÔ∏è ---
function paivitaUI() {
    const container = document.getElementById('ui-content');
    const card = document.getElementById('app-card');
    
    if (vaihe === 1) {
        card.style.borderColor = "#ccc";
        container.innerHTML = `
            <h2>Skannaa Lajimerkki üì∏</h2>
            <form onsubmit="tallennaVaihe(event, 'id')">
                <input type="number" id="input-field" placeholder="6-numeroinen ID" required autofocus>
                <button class="btn-next">VALMIS</button>
            </form>`;
    } 
    else if (vaihe === 2) {
        card.style.borderColor = "#ffd700"; // Keltainen reuna asetukselle
        container.innerHTML = `
            <h2>Asetusaika (min) ‚è±Ô∏è</h2>
            <form onsubmit="tallennaVaihe(event, 'asetusaika')">
                <input type="number" id="input-field" placeholder="0" autofocus>
                <button class="btn-next">VALMIS</button>
                <button type="button" class="btn-skip" onclick="seuraavaVaihe()">OHITA ‚è≠Ô∏è</button>
            </form>`;
    }
    else if (vaihe === 3) {
        card.style.borderColor = "#2196F3"; // Sinert√§v√§ taivutukselce
        container.innerHTML = `
            <h2>Taivutusaika (min) üîÑ</h2>
            <form onsubmit="tallennaVaihe(event, 'taivutusaika')">
                <input type="number" id="input-field" placeholder="0" autofocus>
                <button class="btn-next">VALMIS</button>
                <button type="button" class="btn-skip" onclick="seuraavaVaihe()">OHITA ‚è≠Ô∏è</button>
            </form>`;
    }
    else if (vaihe === 4) {
        card.style.borderColor = "#4CAF50";
        naytaYhteenveto(container);
    }
}

function tallennaVaihe(event, avain) {
    event.preventDefault();
    const val = document.getElementById('input-field').value;
    tyovaiheTiedot[avain] = val;
    
    // √Ñ√§nimerkki alussa (toiveesi mukaisesti)
    if (vaihe === 1) new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg').play();
    
    seuraavaVaihe();
}

function seuraavaVaihe() {
    vaihe++;
    paivitaUI();
}

function naytaYhteenveto(container) {
    let rows = `
        <tr><td>ID</td><td>${tyovaiheTiedot.id}</td><td><button onclick="muokkaa(1)">‚úèÔ∏è</button></td></tr>
        <tr><td>Asetus</td><td>${tyovaiheTiedot.asetusaika} min</td><td><button onclick="muokkaa(2)">‚úèÔ∏è</button></td></tr>
        <tr><td>Taivutus</td><td>${tyovaiheTiedot.taivutusaika} min</td><td><button onclick="muokkaa(3)">‚úèÔ∏è</button></td></tr>
    `;
    
    container.innerHTML = `
        <h2>Yhteenveto üìä</h2>
        <table>${rows}</table>
        <button class="btn-next" onclick="tallennaKaikki()">TALLENNA ‚úÖ</button>
        <button class="btn-reset" onclick="nollaaKaikki()">NOLLAA JAKSO ‚ö†Ô∏è</button>
    `;
}

function muokkaa(v) {
    vaihe = v;
    paivitaUI();
}

function nollaaKaikki() {
    if (confirm("Haluatko varmasti nollata koko jakson historian?")) {
        location.reload();
    }
}

function tallennaKaikki() {
    alert("Tiedot tallennettu objektiin: " + JSON.stringify(tyovaiheTiedot));
    // T√§ss√§ kohtaa tiedot l√§hetett√§isiin eteenp√§in
}

// K√§ynnistys
paivitaUI();
</script>

</body>
</html>
