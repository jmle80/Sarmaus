<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SÃ¤rmÃ¤ys Pro v3.7.9</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        .version-tag { color: #ff8c00; font-weight: bold; padding: 10px; font-size: 0.8rem; text-align: left; }
        body { font-family: sans-serif; margin: 0; background: #f0f2f5; display: flex; justify-content: center; }
        #app-card { background: white; width: 100%; max-width: 500px; min-height: 100vh; padding: 20px; box-sizing: border-box; text-align: center; position: relative; }
        #tyoaika-kello { position: absolute; top: 10px; right: 10px; background: #222; color: #0f0; padding: 8px 15px; border-radius: 6px; font-family: monospace; font-size: 1.2rem; display: none; }
        
        button { width: 100%; padding: 18px; font-size: 1.2rem; border-radius: 12px; border: none; margin: 20px 0; font-weight: bold; cursor: pointer; transition: background 0.3s; }
        .vaihto-nappi-aloita { background: #28a745; color: white; }
        .vaihto-nappi-lopeta { background: #dc3545; color: white; }
        
        input { width: 100%; padding: 15px; font-size: 1.4rem; border-radius: 8px; border: 2px solid #007bff; box-sizing: border-box; margin: 10px 0; text-align: center; }

        /* Suurennettu etsin 300x150 */
        #reader { 
            width: 300px !important; 
            height: 150px !important; 
            margin: 15px auto; 
            border-radius: 12px; 
            overflow: hidden; 
            border: 2px solid #ddd; 
            background: #000; 
        }
        #reader video { 
            object-fit: cover !important; 
            width: 300px !important; 
            height: 150px !important; 
        }
    </style>
</head>
<body>

<div id="app-card">
    <div class="version-tag">Versio 3.7.9 ðŸŸ </div>
    <div id="tyoaika-kello">00:00:00</div>
    
    <div id="skanneri-alue" style="display:none;">
        <h2 id="vaihe-otsikko">SyÃ¶tÃ¤ ID âš¡</h2>
        <div id="reader"></div>
        <input type="text" id="paa-syotto" placeholder="Klikkaa tÃ¤stÃ¤ skannataksesi" onfocus="kaynnistaSkanneri()">
    </div>

    <button id="paa-nappi" class="vaihto-nappi-aloita" onclick="paivitaTila()">ALOITA TYÃ–VUORO ðŸš€</button>
</div>

<script>
let tyoaikaInterval, html5QrCode;
let tila = localStorage.getItem('aloitus_aikaleima') ? "KAYNNISSA" : "ALOITUS";
let aloitusAikaleima = localStorage.getItem('aloitus_aikaleima');

function paivitaTila() {
    if (tila === "ALOITUS") {
        if (confirm("Haluatko aloittaa tyÃ¶vuoron?")) {
            aloitaVuoro();
        }
    } else {
        if (confirm("Haluatko varmasti lopettaa tyÃ¶vuoron?")) {
            lopetaVuoro();
        }
    }
}

function aloitaVuoro() {
    tila = "KAYNNISSA";
    aloitusAikaleima = new Date().getTime();
    localStorage.setItem('aloitus_aikaleima', aloitusAikaleima);
    
    paivitaNÃ¤kymÃ¤();
    
    tyoaikaInterval = setInterval(paivitaKello, 1000);
    new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg').play().catch(() => {});
}

function lopetaVuoro() {
    tila = "ALOITUS";
    clearInterval(tyoaikaInterval);
    localStorage.removeItem('aloitus_aikaleima');
    
    if (html5QrCode) {
        html5QrCode.stop().then(() => {
            paivitaNÃ¤kymÃ¤();
        }).catch(() => paivitaNÃ¤kymÃ¤());
    } else {
        paivitaNÃ¤kymÃ¤();
    }
}

function paivitaNÃ¤kymÃ¤() {
    const nappi = document.getElementById('paa-nappi');
    const kello = document.getElementById('tyoaika-kello');
    const skanneri = document.getElementById('skanneri-alue');

    if (tila === "KAYNNISSA") {
        nappi.innerText = "LOPETA VUORO ðŸ";
        nappi.className = "vaihto-nappi-lopeta";
        kello.style.display = "block";
        skanneri.style.display = "block";
    } else {
        nappi.innerText = "ALOITA TYÃ–VUORO ðŸš€";
        nappi.className = "vaihto-nappi-aloita";
        kello.style.display = "none";
        skanneri.style.display = "none";
    }
}

function kaynnistaSkanneri() {
    if (html5QrCode && html5QrCode.getState() === 2) return;
    
    html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
        { facingMode: "environment" }, 
        { fps: 20, qrbox: { width: 250, height: 100 }, aspectRatio: 2.0 },
        (txt) => { 
            document.getElementById('paa-syotto').value = txt;
            // TÃ¤ssÃ¤ kohtaa voitaisiin lisÃ¤tÃ¤ logiikka ID:n tai Lajimerkin tunnistukseen
        }
    ).catch(err => console.error(err));
}

function paivitaKello() {
    if (!aloitusAikaleima) return;
    const erotus = Math.floor((new Date().getTime() - aloitusAikaleima) / 1000);
    const h = Math.floor(erotus / 3600).toString().padStart(2, '0');
    const m = Math.floor((erotus % 3600) / 60).toString().padStart(2, '0');
    const s = (erotus % 60).toString().padStart(2, '0');
    document.getElementById('tyoaika-kello').innerText = `${h}:${m}:${s}`;
}

window.onload = function() {
    if (tila === "KAYNNISSA") {
        aloitusAikaleima = parseInt(aloitusAikaleima);
        paivitaNÃ¤kymÃ¤();
        tyoaikaInterval = setInterval(paivitaKello, 1000);
    } else {
        paivitaNÃ¤kymÃ¤();
    }
};
</script>
</body>
</html>
