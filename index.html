<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SärmäysPro – VAMM Steel</title>

<style>
:root {
    --vamm-yellow:#fecb00;
    --bg:#000;
    --card:#1a1a1a;
    --text:#fff;
}
*{box-sizing:border-box}
body{
    margin:0;
    padding:10px;
    background:var(--bg);
    color:var(--text);
    font-family:sans-serif;
}
.logo-box{
    text-align:center;
    padding:15px;
    border-bottom:3px solid var(--vamm-yellow);
}
.logo-vamm{font-weight:900;color:var(--vamm-yellow);font-size:2rem}
.logo-steel{font-weight:300;font-size:2rem}
.card{
    background:var(--card);
    padding:20px;
    border-radius:15px;
    margin:15px 0;
    text-align:center;
}
.timer-val{
    font-size:4rem;
    color:var(--vamm-yellow);
    font-family:monospace;
}
.stats-grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:10px;
}
.stat-item{
    background:#000;
    padding:10px;
    border-radius:10px;
}
.stat-nro{font-weight:900;font-size:1.2rem}
.stat-txt{font-size:.6rem;color:#aaa}
.btn-large{
    width:100%;
    height:70px;
    border:none;
    border-radius:12px;
    font-size:1.2rem;
    font-weight:900;
    margin:8px 0;
}
.btn-start{background:var(--vamm-yellow);color:#000}
.btn-stop{background:#c11226;color:#fff}
input{
    width:100%;
    padding:15px;
    margin:6px 0;
    background:#000;
    border:1px solid #444;
    border-radius:10px;
    color:#fff;
    font-size:1.1rem;
    text-align:center;
}
.log-item{
    background:#111;
    padding:12px;
    border-radius:8px;
    margin-top:6px;
    display:flex;
    justify-content:space-between;
    border-left:4px solid var(--vamm-yellow);
}
</style>
</head>

<body>

<div class="logo-box">
    <span class="logo-vamm">VAMM</span><span class="logo-steel">STEEL</span>
</div>

<div class="card">
    <div id="kello" class="timer-val">00:00:00</div>
    <div class="stats-grid">
        <div class="stat-item"><span id="eff_nyt" class="stat-nro">0.00</span><span class="stat-txt">EFF</span></div>
        <div class="stat-item"><span id="min_nyt" class="stat-nro">0</span><span class="stat-txt">MIN</span></div>
        <div class="stat-item" onclick="naytaArkisto()"><span id="eff_jakso" class="stat-nro" style="color:var(--vamm-yellow)">0.00</span><span class="stat-txt">JAKSO</span></div>
    </div>
</div>

<button id="paNappi" class="btn-large btn-start" onclick="hallitseVuoroa()">ALOITA VUORO</button>

<div id="tyoAlue" style="display:none">
    <input id="tyo_id" placeholder="TYÖNUMERO">
    <input id="tyo_laji" placeholder="LAJIMERKKI">
    <input id="tyo_s" type="number" placeholder="ASET">
    <input id="tyo_t" type="number" placeholder="TAIV">
    <input id="tyo_m" type="number" placeholder="MUUT">
    <button class="btn-large btn-start" onclick="tallennaTyo()">TALLENNA TYÖ</button>
</div>

<div id="lista"></div>

<!-- ARKISTO -->
<div id="arkisto" style="display:none;position:fixed;inset:0;background:#000;padding:20px;z-index:1000;overflow:auto">
<button onclick="suljeArkisto()" style="float:right;font-size:2rem;background:none;border:none;color:white">✕</button>
<h2 style="color:var(--vamm-yellow)">HISTORIA</h2>
<div id="arkistoSisalto"></div>
<button class="btn-large btn-stop" onclick="nollaaKaikki()">NOLLAA KAIKKI</button>
</div>

<script>
let muisti = JSON.parse(localStorage.getItem("vamm_data")) || {kaynnissa:false,alku:0,tyot:[]};
let arkisto = JSON.parse(localStorage.getItem("vamm_arkisto")) || [];

function tallenna(){
    localStorage.setItem("vamm_data",JSON.stringify(muisti));
    localStorage.setItem("vamm_arkisto",JSON.stringify(arkisto));
}

function hallitseVuoroa(){
    if(!muisti.kaynnissa){
        muisti.alku=Date.now();
        muisti.kaynnissa=true;
        muisti.tyot=[];
    }else{
        if(confirm("Lopetetaanko vuoro?")){
            arkisto.push(...muisti.tyot);
            muisti={kaynnissa:false,alku:0,tyot:[]};
        }
    }
    tallenna();
    paivitaNakyma();
}

function kello(){
    if(muisti.kaynnissa){
        let ms=Date.now()-muisti.alku;
        let h=Math.floor(ms/3600000);
        let m=Math.floor(ms%3600000/60000);
        let s=Math.floor(ms%60000/1000);
        kelloEl.innerText=`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
        let tmins=muisti.tyot.reduce((a,b)=>a+b.s+b.t+b.m,0);
        min_nyt.innerText=tmins;
        eff_nyt.innerText=(ms>60000?(tmins/(ms/60000)).toFixed(2):"0.00");
        let jakso=arkisto.reduce((a,b)=>a+b.s+b.t+b.m,0)+tmins;
        eff_jakso.innerText=(jakso/480).toFixed(2);
    }
    requestAnimationFrame(kello);
}

function tallennaTyo(){
    let id=tyo_id.value.trim();
    let laji=tyo_laji.value.trim();
    let s=+tyo_s.value,t=+tyo_t.value,m=+tyo_m.value||0;
    if(!id||!laji||!s||!t) return;
    muisti.tyot.push({id,laji,s,t,m});
    tyo_id.value=tyo_laji.value=tyo_s.value=tyo_t.value=tyo_m.value="";
    tallenna(); paivitaLista();
}

function paivitaLista(){
    lista.innerHTML="";
    [...muisti.tyot].reverse().forEach(t=>{
        lista.innerHTML+=`<div class="log-item"><b>${t.id}</b><span>${t.laji}</span><b>${t.s+t.t+t.m} min</b></div>`;
    });
}

function paivitaNakyma(){
    paNappi.innerText=muisti.kaynnissa?"LOPETA VUORO":"ALOITA VUORO";
    paNappi.className="btn-large "+(muisti.kaynnissa?"btn-stop":"btn-start");
    tyoAlue.style.display=muisti.kaynnissa?"block":"none";
    paivitaLista();
}

function naytaArkisto(){
    arkistoSisalto.innerHTML="";
    arkisto.forEach(t=>{
        arkistoSisalto.innerHTML+=`<div class="log-item"><b>${t.id}</b><span>${t.laji}</span><b>${t.s+t.t+t.m} min</b></div>`;
    });
    arkisto.style.display="block";
}
function suljeArkisto(){arkisto.style.display="none";}
function nollaaKaikki(){if(confirm("VARMA?")){localStorage.clear();location.reload();}}

const kelloEl=document.getElementById("kello");
window.onload=()=>{paivitaNakyma();kello();}
</script>

</body>
</html>
